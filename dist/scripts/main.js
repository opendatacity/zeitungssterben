!function(){Z.env={frame:window!==window.top},$(function(){$("body").toggleClass("is-framed",Z.env.frame)})}(),window.photogenic=function(){function t(t){a?t():o.push(t)}function e(e,a){n||t(function(){n=Z.publications.map(function(t){return t}),$("body").addClass("photogenic")}),t(function(){if(0===n.length)return void e(null,!1);for(a=a||0,r++;a>r;)r++,n.shift();i=n.shift(),$(Z).one("Z:chartdrawn",function(){var t=Z.slugify(i)+".png",a={item:i,queue:n,index:r,config:{width:560,height:300}};e(t,a)}),$(Z).trigger("Z:publicationchange",i)})}var n,a=!1,o=[];$(Z).on("Z:ready",function(){a=!0;for(var t;t=o.shift();)t()});var i,r=-1;return e}(),function(){var t=!1;window.addEventListener("message",function(e){if(e.source==window&&e.data.type&&"screenshot_done"==e.data.type){var n=t;t=!1,n&&n()}},!1),window.screenshot=function(e,n){if(t)throw Error("Ein Screenshot nach dem anderen, bitte!");t=n,window.postMessage({type:"screenshot_do",filename:e},"*")}}(),window.screenshotLoop=function(){window.photogenic(function(t){t&&window.setTimeout(function(){window.screenshot("twittercard/"+t,function(){window.screenshotLoop()})},1e3)})},Z.chart=function(){function t(t){return d3.svg.line().x(function(t){return u(t[0])}).y(function(e){return l(t.first.relative*Math.exp(t.lambda*e[1]))})(p)}function e(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g," ")}function n(){if(E)return!1;E=!0,x.append("path").attr("class","line data foreground"),C=x.selectAll(".data"),x.append("path").attr("class","line prediction foreground"),L=x.selectAll(".prediction"),x.append("text").attr("class","data-label max").attr("text-anchor","start").attr("dx",10).attr("dy",-10),x.append("circle").attr("r",8).attr("class","data-label max"),x.append("text").attr("class","data-label min").attr("text-anchor","end").attr("dx",-10).attr("dy",35),x.append("circle").attr("r",8).attr("class","data-label min"),k=x.selectAll(".data-label.max"),D=x.selectAll(".data-label.min");var t=$("form");return $(window).on("resize keyup typeahead:closed",function(){var e=t.outerHeight(),n=$("body").outerHeight()-e;$("#main-chart").css("max-height",.98*n)}),!0}function a(){var n=$("body").hasClass("photogenic")?0:200,a=1/0===i.regression.halfLife?"keine":Math.round(i.regression.halfLife)+" Jahre",o=new Date-i.newest.date>=157788e5;$(".data-sheet").removeClass("hidden").toggleClass("toggle-animation"),$(".js-publication-title").text(i.title),$(".js-publication-halflife").text(a),$(".js-old-data-warning").toggleClass("hidden",!o),$(".js-old-data-value").text(i.newest.quarterString()),C.datum(i).transition().duration(n).attr("d",function(t){return w(t.copies)}),L.transition().duration(n).attr("d",t(i.regression)),k.datum(i).transition().duration(n).attr("cx",function(t){return d(t.max)}).attr("x",function(t){return d(t.max)}).attr("cy",function(t){return f(t.max)}).attr("y",function(t){return f(t.max)}).text(function(t){return e(t.max.absolute)}),D.datum(i).transition().duration(n).attr("cx",function(t){return d(t.min)}).attr("x",function(t){return d(t.min)}).attr("cy",function(t){return f(t.min)}).attr("y",function(t){return f(t.min)}).text(function(t){return e(t.min.absolute)}),$(Z).trigger("Z:chartdrawn")}function o(t){i=t,n(),a()}var i,r=800,c=600,s=50,u=d3.time.scale().range([0,r]),l=d3.scale.linear().range([c,0]),d=function(t){return u(t.date)},f=function(t){return l(t.relative)};u.domain([new Date(2e3,0,1),new Date(2040,0,1)]),l.domain([0,1]);for(var h=d3.svg.axis().scale(u).orient("bottom"),g=d3.svg.axis().scale(l).orient("left"),p=[],m=u.domain()[0],b=u.domain()[1],v=-6;b>=m;m.setFullYear(m.getFullYear()+1))p.push([new Date(+m),v+=4]);var w=d3.svg.line().x(d).y(f),y=[0,0,r+2*s,c+2*s],x=d3.select("#main-chart").attr("width",y[2]).attr("height",y[3]).attr("viewBox",y.join(" "));x=x.append("g").attr("transform","translate("+s+","+s+")"),x.append("g").attr("class","x axis").call(h).attr("transform","translate(0,"+c+")"),x.append("g").attr("class","y axis").call(g);var C,L,k,D,E=!1;return{draw:o}}(),$(Z).on("Z:ready",function(){var t=["#aaa","white"],e=function(t,e){$("body, .publications-list").css({backgroundColor:t,color:e}),$("svg").css({stroke:e,fill:e}),$("#modals-pane a").css({color:e})},n=Z.publications.map(function(t){return t.regression.halfLife});n=[0,150];var a=chroma.scale(t).domain(n).correctLightness(!1),o=function(){var t=null,e=!1;return $(document.body).on("typeahead:opened",function(){e=!0}),$(document.body).on("typeahead:closed",function(){e=!1,t&&(t(),t=null)}),function(n){e?t=n:n()}}();Z.colorchange=function(t){var n,i;t.bg?i=t.bg:(i=a(t.regression.halfLife),t.bg=i),n=chroma(i.luminance()>.4?"black":"white"),o(function(){e(i,n)})}}),function(){function t(t,e,n){var a=/[^a-zäöüß\*]/gi;e.forEach||(e=[e]);e.length;return function(o,i){try{o="/"===o.substr(0,1)?new RegExp(o.substr(1),"i"):new RegExp(o.toLowerCase().replace(a,"").replace("*",".*"));var r=t.filter(function(t){for(var n=0,i="";i=e[n++];)if(t[i]&&t[i].toLowerCase().replace(a,"").match(o))return!0;return!1}).sort(function(t,e){return e.max.absolute-t.max.absolute})}catch(c){var r=[]}n&&n(r),i(r.slice(0,10))}}function e(t){1===t.length&&$(Z).trigger("Z:publicationchange",t[0])}function n(n){a=n,Z.findPublication=t(a,["title","alias"],e);var o=$("#tf-publication");o.typeahead({minLength:1,highlight:!0},{name:"publications",source:Z.findPublication,displayKey:"title"}),o.hasClass("autofocus")&&!Z.env.frame&&o.focus(),o.on("typeahead:cursorchanged typeahead:selected typeahead:autocompleted",function(t,e){$(Z).trigger("Z:publicationchange",e)}),o.on("blur",function(){var t=$(this).data("publication");t&&$(this).val(t.title)}),o.on("focus",function(){$(this).select()}),o.on("keyup",function(t){13===t.keyCode&&($("form").triggerHandler("submit"),o.blur())}),$("form").on("submit",function(t){t.preventDefault(),Z.findPublication(o.val(),function(t){t&&0!==t.length&&$(Z).trigger("Z:publicationchange",t[0])})}),$(Z).on("Z:publicationchange",function(t,e){o.is(":focus")&&""!==o.val()||o.val(e.title),o.data("publication",e)})}var a,o={};o.init=n,Z.autocomplete=o}(),function(){d3.tsv("data/data.tsv",function(t,e){function n(t){var e=new Date(s);return e.setMonth((t-c)*(12/r)),e}function a(t,e){this.quarter=+t,this.date=n(+t),this.absolute=+e}function o(t,e){this.first={absolute:+t.N0},e&&(this.first.relative=this.first.absolute/e.absolute),this.lambda=+t.lambda,this.halfLife=-i/t.lambda/r,this.halfLife<0&&(this.halfLife=1/0)}var i=Math.log(2),r=4,c=0,s=+new Date(2001,0,1);a.prototype.quarterString=function(){var t=1+(this.quarter-c)%4,e=this.date.getFullYear();return t+". Quartal "+e};var u=e.map(function(t){var e,n,i=[];for(column in t)if(t.hasOwnProperty(column)){var r=t[column];if((""+column).match(/^[0-9]+$/)&&""!==r){var c=new a(column,r);i.push(c),(!e||e.absolute<c.absolute)&&(e=c),(!n||n.absolute>c.absolute)&&(n=c)}}return i.forEach(function(t){t.relative=t.absolute/e.absolute}),{title:t.title,alias:t.alias,copies:i,max:e,min:n,oldest:i[0],newest:i[i.length-1],regression:new o(t,e)}});u.sort(function(t,e){return e.max.absolute-t.max.absolute}),$(function(){Z.publications=u,Z.autocomplete.init(u),$(Z).trigger("Z:ready",[u])})}),$(Z).on("Z:publicationchange",function(t,e){Z.chart.draw(e),Z.colorchange(e)})}(),$(function(){$("body").on("focus","input",function(){$(this).parents("form").addClass("focus")}),$("body").on("blur","input",function(){$(this).parents("form").removeClass("focus")}),$(".autofocus").parents("form").addClass("has-autofocus").mouseup(function(t){t.target===this&&$(this).find(".autofocus").focus()})}),function(){function t(t){if(t.slug)return t.slug;var n=t.title.toLowerCase();return e.forEach(function(t){n=n.replace(t.search,t.replace)}),t.slug=n,n}var e=[{search:/ä/gi,replace:"ae"},{search:/ö/gi,replace:"oe"},{search:/ü/gi,replace:"ue"},{search:/ß/g,replace:"ss"},{search:/[éèê]/gi,replace:"e"},{search:/[áàâ]/gi,replace:"a"},{search:/'/g,replace:""},{search:/[^a-z0-9]+$/gi,replace:""},{search:/[^a-z0-9]+/gi,replace:"-"}];"undefined"!=typeof Z&&(Z.slugify=t),"undefined"!=typeof module&&(module.exports=t)}(),$(function(){var t=document.title;$(Z).on("Z:publicationchange",function(e,n){document.title=[n.title,t].join(": "),"function"==typeof history.replaceState&&(history.replaceState(n,n.title,Z.slugify(n)),$(Z).trigger("Z:statechange"))}),$(Z).on("Z:ready",function(t,e){var n=window.location.pathname.split("/").pop();if(""!==n)for(var a=0,o=e.length;o>a;a++)if(n===Z.slugify(e[a])){$(Z).trigger("Z:publicationchange",e[a]);break}})}),$(function(){function t(t){t&&t.target!==this||$("."+n).removeClass(n)}function e(){$embedCode.val($embedCode.val().replace(/src=".*?"/,'src="'+window.location+'"'))}var n="modal-active",a=$(".modal-foreground, .modal-background");$(".modal").each(function(){var t=$(this),e=$("a[href=#"+t.attr("id")+"]");e.click(function(e){e.preventDefault(),a.addClass(n),t.addClass(n)})}),$(".modal-foreground, .modal-close").click(t),$(window).keyup(function(e){27===e.keyCode&&t()}),$embedCode=$("#embed-code"),$(Z).on("Z:statechange ready",e),e(),$embedCode.focus(function(){$embedCode.select()})});